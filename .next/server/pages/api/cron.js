"use strict";(()=>{var e={};e.id=267,e.ids=[267],e.modules={8013:e=>{e.exports=require("mongodb")},1287:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},983:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>c,default:()=>d,routeModule:()=>u});var s=a(1802),o=a(7153),n=a(6249),i=a(4015),l=e([i]);i=(l.then?(await l)():l)[0];let d=(0,n.l)(i,"default"),c=(0,n.l)(i,"config"),u=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/cron",pathname:"/api/cron",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},4015:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>handler});var s=a(712),o=a(6834),n=e([o]);async function handler(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});let a=e.headers.authorization;if(process.env.CRON_SECRET&&a!==`Bearer ${process.env.CRON_SECRET}`)return t.status(401).json({message:"Unauthorized"});try{let e=process.env.TOKEN_ADDRESS,a=process.env.REWARD_WALLET;if(!e||!a)return t.status(500).json({message:"Environment variables not configured"});let r=await (0,o.gb)(e),n=await (0,o.pd)(a);if(0===r.length)return t.status(400).json({message:"No eligible holders found"});let i=(0,o.Q0)(r);if(s.Z&&null===s.r){let e=await s.Z;if(!e)throw Error("Failed to connect to database");let a=e.db("belive-jackpot"),o=a.collection("rounds"),l=await o.find({}).sort({round:-1}).limit(1).toArray(),d=l.length>0?l[0].round+1:1,c={round:d,timestamp:new Date().toISOString(),winner:i,rewardAmount:n.balance,holders:r.slice(0,10),totalHolders:r.length,totalTickets:r.reduce((e,t)=>e+t.tickets,0)};await o.insertOne(c),console.log(`Round ${d} completed. Winner: ${i}`),t.status(200).json({success:!0,round:d,winner:i,rewardAmount:n.balance})}else console.log("MongoDB not available, skipping round processing"),t.status(200).json({success:!1,message:"Database not available"})}catch(e){console.error("Error processing round:",e),t.status(500).json({message:"Internal server error"})}}o=(n.then?(await n)():n)[0],r()}catch(e){r(e)}})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[222,712,834],()=>__webpack_exec__(983));module.exports=a})();